from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from bs4 import BeautifulSoup

options = Options()
options.add_argument("--headless")
options.add_argument("--disable-gpu")
options.add_argument("--window-size=1920,1080")

driver = webdriver.Chrome(options=options)

try:
    url = "https://hellosafe.com.br/seguro-viagem"
    driver.get(url)

    WebDriverWait(driver, 15).until(
        EC.presence_of_element_located((By.CSS_SELECTOR, "div.tw-relative.tw-grid-cols-10.tw-bg-white.tw-grid"))
    )

    html = driver.page_source
    soup = BeautifulSoup(html, "html.parser")

    seguros = soup.select("div.tw-relative.tw-grid-cols-10.tw-bg-white.tw-grid")

    # Vamos montar o conteúdo HTML para o front
    html_output = """
    <html>
    <head>
        <meta charset="utf-8" />
        <title>Seguros de Viagem</title>
        <style>
            body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
            .card {
                background: white;
                border-radius: 8px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                padding: 20px;
                margin-bottom: 20px;
                max-width: 700px;
            }
            h2 { margin-top: 0; color: #333; }
            a { color: #1a73e8; text-decoration: none; }
            a:hover { text-decoration: underline; }
            ul { padding-left: 20px; }
            hr { border: none; border-top: 1px solid #eee; margin: 20px 0; }
            .avaliacao {
                font-weight: bold;
                color: #e67e22;
            }
            .preco {
                font-weight: bold;
                color: #27ae60;
            }
            .section-title {
                margin-top: 15px;
                font-weight: bold;
                color: #555;
            }
        </style>
    </head>
    <body>
        <h1>Seguros de Viagem</h1>
    """

    for seguro in seguros:
        # Extrair dados
        link_tag = seguro.select_one("a[href]")
        link = link_tag['href'] if link_tag else "#"
        nome_tag = seguro.select_one("a > div[data-testid='logo-subtitle']")
        nome = nome_tag.get_text(strip=True) if nome_tag else "N/A"
        avaliacao_tag = seguro.select_one("div.tw-text-cultured-900.tw-flex.items-center.tw-font-bold.tw-text-2xl")
        avaliacao = avaliacao_tag.get_text(strip=True) if avaliacao_tag else "N/A"

        preco = "N/A"
        divs_texto = seguro.find_all("div", string=lambda text: text and ("R$" in text or "Preço" in text))
        if divs_texto:
            preco = divs_texto[0].get_text(strip=True)

        coberturas = []
        infos_bagagem = []
        beneficios = seguro.select("div.tw-flex.tw-gap-2")
        for beneficio in beneficios:
            textos = beneficio.stripped_strings
            textos_lista = list(textos)
            texto_concatenado = " ".join(textos_lista).lower()
            if "bagagem" in texto_concatenado:
                infos_bagagem.append(" ".join(textos_lista))
            else:
                coberturas.append(" ".join(textos_lista))

        # Montar card HTML
        html_output += f"""
        <div class="card">
            <h2><a href="{link}" target="_blank" rel="noopener">{nome}</a></h2>
            <div class="avaliacao">Avaliação: {avaliacao}</div>
            <div class="preco">Preço: {preco}</div>

            <div class="section-title">Cobertura:</div>
            <ul>
        """
        for c in coberturas:
            html_output += f"<li>{c}</li>"

        html_output += """
            </ul>
            <div class="section-title">Informações de bagagem:</div>
            <ul>
        """

        for b in infos_bagagem:
            html_output += f"<li>{b}</li>"

        html_output += """
            </ul>
        </div>
        """

    html_output += """
    </body>
    </html>
    """

    # Salvar arquivo HTML
    with open("seguros_viagem.html", "w", encoding="utf-8") as f:
        f.write(html_output)

    print("Arquivo 'seguros_viagem.html' criado com sucesso! Abra-o no navegador para ver os cards separados.")

finally:
    driver.quit()
